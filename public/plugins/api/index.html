<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg"
    />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.5.26
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <title>Plugin API</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/plugins/api" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" href="/">UmiJS</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/docs">Docs</a></span><span><a href="/config">Config</a></span><span><a href="/api">API</a></span><span><a href="/guide">Guide</a></span><span><a aria-current="page" class="active" href="/plugins">Plugins</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://v2.umijs.org">v2.x<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/zh-CN/plugins/api">中文</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" href="/"></a><h1>UmiJS</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/docs">Docs</a></li><li><a href="/config">Config</a></li><li><a href="/api">API</a></li><li><a href="/guide">Guide</a></li><li><a aria-current="page" class="active" href="/plugins">Plugins</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v2.umijs.org">v2.x<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/zh-CN/plugins/api">中文</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">Presets</a><ul><li><a href="/plugins/preset-react"><span>@umijs/preset-react</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">Plugins</a><ul><li><a href="/plugins/plugin-access"><span>@umijs/plugin-access</span></a></li><li><a href="/plugins/plugin-analytics"><span>@umijs/plugin-analytics</span></a></li><li><a href="/plugins/plugin-antd-mobile"><span>@umijs/plugin-antd-mobile</span></a></li><li><a href="/plugins/plugin-crossorigin"><span>@umijs/plugin-crossorigin</span></a></li><li><a href="/plugins/plugin-dva"><span>@umijs/plugin-dva</span></a></li><li><a href="/plugins/plugin-esbuild"><span>@umijs/plugin-esbuild</span></a></li><li><a href="/plugins/plugin-helmet"><span>@umijs/plugin-helmet</span></a></li><li><a href="/plugins/plugin-initial-state"><span>@umijs/plugin-initial-state</span></a></li><li><a href="/plugins/plugin-layout"><span>@umijs/plugin-layout</span></a></li><li><a href="/plugins/plugin-locale"><span>@umijs/plugin-locale</span></a></li><li><a href="/plugins/plugin-model"><span>@umijs/plugin-model</span></a></li><li><a href="/plugins/plugin-preact"><span>@umijs/plugin-preact</span></a></li><li><a href="/plugins/plugin-qiankun"><span>@umijs/plugin-qiankun</span></a></li><li><a href="/plugins/plugin-request"><span>@umijs/plugin-request</span></a></li><li><a href="/plugins/plugin-sass"><span>@umijs/plugin-sass</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">Plugin Develop</a><ul><li><a aria-current="page" class="active" href="/plugins/api"><span>Plugin API</span></a></li><li><a href="/plugins/best-practice"><span>Plugin Best Practice</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="核心方法" data-depth="2"><a href="/plugins/api#核心方法"><span>核心方法</span></a></li><li title="applyPlugins({ key: string, type: api.ApplyPluginsType, initialValue?: any, args?: any })" data-depth="3"><a href="/plugins/api#applyplugins-key-string-type-apiapplypluginstype-initialvalue-any-args-any-"><span>applyPlugins({ key: string, type: api.ApplyPluginsType, initialValue?: any, args?: any })</span></a></li><li title="describe({ id?: string, key?: string, config?: { default, schema, onChange } })" data-depth="3"><a href="/plugins/api#describe-id-string-key-string-config--default-schema-onchange--"><span>describe({ id?: string, key?: string, config?: { default, schema, onChange } })</span></a></li><li title="register({ key: string, fn: Function, pluginId?: string, before?: string, stage?: number })" data-depth="3"><a href="/plugins/api#register-key-string-fn-function-pluginid-string-before-string-stage-number-"><span>register({ key: string, fn: Function, pluginId?: string, before?: string, stage?: number })</span></a></li><li title="registerCommand({ name: string, alias?: string, fn: Function })" data-depth="3"><a href="/plugins/api#registercommand-name-string-alias-string-fn-function-"><span>registerCommand({ name: string, alias?: string, fn: Function })</span></a></li><li title="registerMethod({ name: string, fn?: Function, exitsError?: boolean })" data-depth="3"><a href="/plugins/api#registermethod-name-string-fn-function-exitserror-boolean-"><span>registerMethod({ name: string, fn?: Function, exitsError?: boolean })</span></a></li><li title="registerPresets(presets: string[])" data-depth="3"><a href="/plugins/api#registerpresetspresets-string"><span>registerPresets(presets: string[])</span></a></li><li title="registerPlugins(plugins: string[])" data-depth="3"><a href="/plugins/api#registerpluginsplugins-string"><span>registerPlugins(plugins: string[])</span></a></li><li title="hasPlugins(pluginIds: string[])" data-depth="3"><a href="/plugins/api#haspluginspluginids-string"><span>hasPlugins(pluginIds: string[])</span></a></li><li title="hasPresets(presetIds: string[])" data-depth="3"><a href="/plugins/api#haspresetspresetids-string"><span>hasPresets(presetIds: string[])</span></a></li><li title="skipPlugins(pluginIds: string[])" data-depth="3"><a href="/plugins/api#skippluginspluginids-string"><span>skipPlugins(pluginIds: string[])</span></a></li><li title="扩展方法" data-depth="2"><a href="/plugins/api#扩展方法"><span>扩展方法</span></a></li><li title="addBeforeMiddlewares" data-depth="3"><a href="/plugins/api#addbeforemiddlewares"><span>addBeforeMiddlewares</span></a></li><li title="addDepInfo" data-depth="3"><a href="/plugins/api#adddepinfo"><span>addDepInfo</span></a></li><li title="addEntryCode" data-depth="3"><a href="/plugins/api#addentrycode"><span>addEntryCode</span></a></li><li title="addEntryCodeAhead" data-depth="3"><a href="/plugins/api#addentrycodeahead"><span>addEntryCodeAhead</span></a></li><li title="addEntryImports" data-depth="3"><a href="/plugins/api#addentryimports"><span>addEntryImports</span></a></li><li title="addEntryImportsAhead" data-depth="3"><a href="/plugins/api#addentryimportsahead"><span>addEntryImportsAhead</span></a></li><li title="addHTMLMetas" data-depth="3"><a href="/plugins/api#addhtmlmetas"><span>addHTMLMetas</span></a></li><li title="addHTMLLinks" data-depth="3"><a href="/plugins/api#addhtmllinks"><span>addHTMLLinks</span></a></li><li title="addHTMLStyles" data-depth="3"><a href="/plugins/api#addhtmlstyles"><span>addHTMLStyles</span></a></li><li title="addHTMLScripts" data-depth="3"><a href="/plugins/api#addhtmlscripts"><span>addHTMLScripts</span></a></li><li title="addHTMLHeadScripts" data-depth="3"><a href="/plugins/api#addhtmlheadscripts"><span>addHTMLHeadScripts</span></a></li><li title="addMiddlewares" data-depth="3"><a href="/plugins/api#addmiddlewares"><span>addMiddlewares</span></a></li><li title="addPolyfillImports" data-depth="3"><a href="/plugins/api#addpolyfillimports"><span>addPolyfillImports</span></a></li><li title="addProjectFirstLibraries" data-depth="3"><a href="/plugins/api#addprojectfirstlibraries"><span>addProjectFirstLibraries</span></a></li><li title="addRuntimePlugin" data-depth="3"><a href="/plugins/api#addruntimeplugin"><span>addRuntimePlugin</span></a></li><li title="addRuntimePluginKey" data-depth="3"><a href="/plugins/api#addruntimepluginkey"><span>addRuntimePluginKey</span></a></li><li title="addUmiExports" data-depth="3"><a href="/plugins/api#addumiexports"><span>addUmiExports</span></a></li><li title="addTmpGenerateWatcherPaths" data-depth="3"><a href="/plugins/api#addtmpgeneratewatcherpaths"><span>addTmpGenerateWatcherPaths</span></a></li><li title="chainWebpack(config, { webpack })" data-depth="3"><a href="/plugins/api#chainwebpackconfig--webpack-"><span>chainWebpack(config, { webpack })</span></a></li><li title="getPort()" data-depth="3"><a href="/plugins/api#getport"><span>getPort()</span></a></li><li title="getHostname()" data-depth="3"><a href="/plugins/api#gethostname"><span>getHostname()</span></a></li><li title="modifyBabelOpts" data-depth="3"><a href="/plugins/api#modifybabelopts"><span>modifyBabelOpts</span></a></li><li title="modifyBabelPresetOpts" data-depth="3"><a href="/plugins/api#modifybabelpresetopts"><span>modifyBabelPresetOpts</span></a></li><li title="modifyBundleConfig" data-depth="3"><a href="/plugins/api#modifybundleconfig"><span>modifyBundleConfig</span></a></li><li title="modifyBundleConfigs" data-depth="3"><a href="/plugins/api#modifybundleconfigs"><span>modifyBundleConfigs</span></a></li><li title="modifyBundleConfigOpts" data-depth="3"><a href="/plugins/api#modifybundleconfigopts"><span>modifyBundleConfigOpts</span></a></li><li title="modifyBundleImplementor" data-depth="3"><a href="/plugins/api#modifybundleimplementor"><span>modifyBundleImplementor</span></a></li><li title="modifyBundler" data-depth="3"><a href="/plugins/api#modifybundler"><span>modifyBundler</span></a></li><li title="modifyConfig" data-depth="3"><a href="/plugins/api#modifyconfig"><span>modifyConfig</span></a></li><li title="modifyDefaultConfig" data-depth="3"><a href="/plugins/api#modifydefaultconfig"><span>modifyDefaultConfig</span></a></li><li title="modifyHTML" data-depth="3"><a href="/plugins/api#modifyhtml"><span>modifyHTML</span></a></li><li title="modifyHTMLChunks" data-depth="3"><a href="/plugins/api#modifyhtmlchunks"><span>modifyHTMLChunks</span></a></li><li title="modifyExportRouteMap " data-depth="3"><a href="/plugins/api#modifyexportroutemap"><span>modifyExportRouteMap </span></a></li><li title="modifyDevHTMLContent " data-depth="3"><a href="/plugins/api#modifydevhtmlcontent"><span>modifyDevHTMLContent </span></a></li><li title="modifyProdHTMLContent " data-depth="3"><a href="/plugins/api#modifyprodhtmlcontent"><span>modifyProdHTMLContent </span></a></li><li title="modifyPaths" data-depth="3"><a href="/plugins/api#modifypaths"><span>modifyPaths</span></a></li><li title="modifyRendererPath" data-depth="3"><a href="/plugins/api#modifyrendererpath"><span>modifyRendererPath</span></a></li><li title="modifyPublicPathStr" data-depth="3"><a href="/plugins/api#modifypublicpathstr"><span>modifyPublicPathStr</span></a></li><li title="modifyRoutes" data-depth="3"><a href="/plugins/api#modifyroutes"><span>modifyRoutes</span></a></li><li title="onPatchRoute({ route, parentRoute })" data-depth="3"><a href="/plugins/api#onpatchroute-route-parentroute-"><span>onPatchRoute({ route, parentRoute })</span></a></li><li title="onPatchRouteBefore({ route, parentRoute })" data-depth="3"><a href="/plugins/api#onpatchroutebefore-route-parentroute-"><span>onPatchRouteBefore({ route, parentRoute })</span></a></li><li title="onPatchRoutes({ routes, parentRoute })" data-depth="3"><a href="/plugins/api#onpatchroutes-routes-parentroute-"><span>onPatchRoutes({ routes, parentRoute })</span></a></li><li title="onPatchRoutesBefore({ routes, parentRoute })" data-depth="3"><a href="/plugins/api#onpatchroutesbefore-routes-parentroute-"><span>onPatchRoutesBefore({ routes, parentRoute })</span></a></li><li title="onBuildComplete({ err?, stats? })" data-depth="3"><a href="/plugins/api#onbuildcomplete-err-stats-"><span>onBuildComplete({ err?, stats? })</span></a></li><li title="onDevCompileDone({ isFirstCompile: boolean, stats: webpack.Stats })" data-depth="3"><a href="/plugins/api#ondevcompiledone-isfirstcompile-boolean-stats-webpackstats-"><span>onDevCompileDone({ isFirstCompile: boolean, stats: webpack.Stats })</span></a></li><li title="onGenerateFiles" data-depth="3"><a href="/plugins/api#ongeneratefiles"><span>onGenerateFiles</span></a></li><li title="onPluginReady()" data-depth="3"><a href="/plugins/api#onpluginready"><span>onPluginReady()</span></a></li><li title="onStart()" data-depth="3"><a href="/plugins/api#onstart"><span>onStart()</span></a></li><li title="onExit()" data-depth="3"><a href="/plugins/api#onexit"><span>onExit()</span></a></li><li title="writeTmpFile({ path: string, content: string, skipTSCheck?: boolean })" data-depth="3"><a href="/plugins/api#writetmpfile-path-string-content-string-skiptscheck-boolean-"><span>writeTmpFile({ path: string, content: string, skipTSCheck?: boolean })</span></a></li><li title="属性" data-depth="2"><a href="/plugins/api#属性"><span>属性</span></a></li><li title="args" data-depth="3"><a href="/plugins/api#args"><span>args</span></a></li><li title="babelRegister.setOnlyMap({ key: string, value: string[] })" data-depth="3"><a href="/plugins/api#babelregistersetonlymap-key-string-value-string-"><span>babelRegister.setOnlyMap({ key: string, value: string[] })</span></a></li><li title="config" data-depth="3"><a href="/plugins/api#config"><span>config</span></a></li><li title="cwd" data-depth="3"><a href="/plugins/api#cwd"><span>cwd</span></a></li><li title="env" data-depth="3"><a href="/plugins/api#env"><span>env</span></a></li><li title="id" data-depth="3"><a href="/plugins/api#id"><span>id</span></a></li><li title="logger" data-depth="3"><a href="/plugins/api#logger"><span>logger</span></a></li><li title="key" data-depth="3"><a href="/plugins/api#key"><span>key</span></a></li><li title="paths" data-depth="3"><a href="/plugins/api#paths"><span>paths</span></a></li><li title="pkg" data-depth="3"><a href="/plugins/api#pkg"><span>pkg</span></a></li><li title="service" data-depth="3"><a href="/plugins/api#service"><span>service</span></a></li><li title="stage" data-depth="3"><a href="/plugins/api#stage"><span>stage</span></a></li><li title="userConfig" data-depth="3"><a href="/plugins/api#userconfig"><span>userConfig</span></a></li><li title="utils" data-depth="3"><a href="/plugins/api#utils"><span>utils</span></a></li><li title="ApplyPluginsType" data-depth="3"><a href="/plugins/api#applypluginstype"><span>ApplyPluginsType</span></a></li><li title="ConfigChangeType" data-depth="3"><a href="/plugins/api#configchangetype"><span>ConfigChangeType</span></a></li><li title="EnableBy" data-depth="3"><a href="/plugins/api#enableby"><span>EnableBy</span></a></li><li title="Html" data-depth="3"><a href="/plugins/api#html"><span>Html</span></a></li><li title="ServiceStage" data-depth="3"><a href="/plugins/api#servicestage"><span>ServiceStage</span></a></li><li title="环境变量" data-depth="2"><a href="/plugins/api#环境变量"><span>环境变量</span></a></li></ul><div class="__dumi-default-layout-content"><div class="__dumi-default-alert">This article has not been translated yet. Want to help us out? Click the Edit this doc on GitHub at the end of the page.</div><div class="markdown"><h1 id="plugin-api"><a aria-hidden="true" tabindex="-1" href="/plugins/api#plugin-api"><span class="icon icon-link"></span></a>Plugin API</h1><h2 id="核心方法"><a aria-hidden="true" tabindex="-1" href="/plugins/api#核心方法"><span class="icon icon-link"></span></a>核心方法</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi/blob/master/packages/core/src/Service/Service.ts">Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi/blob/master/packages/core/src/Service/PluginAPI.ts">PluginAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 里定义的方法。</p><h3 id="applyplugins-key-string-type-apiapplypluginstype-initialvalue-any-args-any-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#applyplugins-key-string-type-apiapplypluginstype-initialvalue-any-args-any-"><span class="icon icon-link"></span></a>applyPlugins(<!-- -->{<!-- --> key: string, type: api.ApplyPluginsType, initialValue?: any, args?: any <!-- -->}<!-- -->)</h3><p>取得 register 注册的 hooks 执行后的数据。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token method function property-access">applyPlugins</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ApplyPluginsType</span><span class="token punctuation">.</span><span class="token property-access">add</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  initialValue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// [&#x27;a&#x27;, &#x27;b&#x27;]</span></div></pre></div><h3 id="describe-id-string-key-string-config--default-schema-onchange--"><a aria-hidden="true" tabindex="-1" href="/plugins/api#describe-id-string-key-string-config--default-schema-onchange--"><span class="icon icon-link"></span></a>describe(<!-- -->{<!-- --> id?: string, key?: string, config?: <!-- -->{<!-- --> default, schema, onChange <!-- -->}<!-- --> <!-- -->}<!-- -->)</h3><p>注册阶段执行，用于描述插件或插件集的 id、key、配置信息、启用方式等。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">describe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;history&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  config</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;browser&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token plain">joi</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> joi</span><span class="token punctuation">.</span><span class="token method function property-access">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    onChange</span><span class="token operator">:</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ConfigChangeType</span><span class="token punctuation">.</span><span class="token property-access">regenerateTmpFiles</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  enableBy</span><span class="token operator">:</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">EnableBy</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li><code>config.default</code> 为配置的默认值，用户没有配置时取这个</li><li><code>config.schema</code> 用于声明配置的类型，基于 <a target="_blank" rel="noopener noreferrer" href="https://joi.dev/">joi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<strong>如果你希望用户进行配置，这个是必须的</strong>，否则用户的配置无效</li><li><code>config.onChange</code> 是 dev 阶段配置被修改后的处理机制，默认会重启 dev 进程，也可以修改为 <code>api.ConfigChangeType.regenerateTmpFiles</code> 只重新生成临时文件，还可以通过函数的格式自定义</li><li><code>enableBy</code> 为启用方式，默认是注册启用，可更改为 <code>api.EnableBy.config</code>，还可以用自定义函数的方式决定其启用时机（动态生效）</li></ul><h3 id="register-key-string-fn-function-pluginid-string-before-string-stage-number-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#register-key-string-fn-function-pluginid-string-before-string-stage-number-"><span class="icon icon-link"></span></a>register(<!-- -->{<!-- --> key: string, fn: Function, pluginId?: string, before?: string, stage?: number <!-- -->}<!-- -->)</h3><p>为 <code>api.applyPlugins</code> 注册可供其使用的 hook。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 可同步</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token string">&#x27;a&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 可异步</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token string">&#x27;b&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>然后通过 <code>api.applyPlugins</code> 即可拿到 <code>[&#x27;a&#x27;, &#x27;b&#x27;]</code>，</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token method function property-access">applyPlugins</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ApplyPluginsType</span><span class="token punctuation">.</span><span class="token property-access">add</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  initialValue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// [&#x27;a&#x27;, &#x27;b&#x27;]</span></div></pre></div><p>注：</p><ul><li>fn 支持同步和异步，异步通过 Promise，返回值为 Promise 即为异步</li><li>fn 里的内容需结合 <code>api.appyPlugins</code> 的 type 参数来看 _ 如果是 <code>api.ApplyPluginsType.add</code>，需有返回值，这些返回值最终会被合成一个数组 _ 如果是 <code>api.ApplyPluginsType.modify</code>，需对第一个参数做修改，并返回 * 如果是 <code>api.ApplyPluginsType.event</code>，无需返回值</li><li>stage 和 before 都是用于调整执行顺序的，参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/webpack/tapable">tapable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>stage 默认是 0，设为 -1 或更少会提前执行，设为 1 或更多会后置执行</li></ul><h3 id="registercommand-name-string-alias-string-fn-function-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#registercommand-name-string-alias-string-fn-function-"><span class="icon icon-link"></span></a>registerCommand(<!-- -->{<!-- --> name: string, alias?: string, fn: Function <!-- -->}<!-- -->)</h3><p>注册命令。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">registerCommand</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;generate&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    alias</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;g&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">fn</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> args </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">hello </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">api</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">args</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">projectName</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li><code>alias</code> 为别名，比如 generate 的别名 g</li><li><code>fn</code> 的参数为 <code>{<!-- --> args <!-- -->}</code>，args 的格式同 <a target="_blank" rel="noopener noreferrer" href="https://github.com/yargs/yargs">yargs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的解析结果，需要注意的是 <code>_</code> 里的 command 本身被去掉了，比如执行 <code>umi generate page foo</code>，<code>args._</code> 为 <code>[&#x27;page&#x27;, &#x27;foo&#x27;]</code></li></ul><h3 id="registermethod-name-string-fn-function-exitserror-boolean-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#registermethod-name-string-fn-function-exitserror-boolean-"><span class="icon icon-link"></span></a>registerMethod(<!-- -->{<!-- --> name: string, fn?: Function, exitsError?: boolean <!-- -->}<!-- -->)</h3><p>往 api 上注册方法。可以是 <code>api.register()</code> 的快捷使用方式，便于调用；也可以不是，如果有提供 <code>fn</code>，则执行 <code>fn</code> 定义的函数。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">registerMethod</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    exitsError</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li>除 @umijs/preset-build-in 外，通常不建议注册额外的方法，因为没有 ts 提示，直接使用 <code>api.register()</code> 就好</li><li><code>exitsError</code> 默认为 true，如果方法存在则报错</li></ul><h3 id="registerpresetspresets-string"><a aria-hidden="true" tabindex="-1" href="/plugins/api#registerpresetspresets-string"><span class="icon icon-link"></span></a>registerPresets(presets: string[])</h3><p>注册插件集，参数为路径数组。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">registerPresets</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;preset_2&#x27;</span><span class="token punctuation">,</span><span class="token plain"> key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;preset2&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function-variable function">apply</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./preset_3&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="registerpluginsplugins-string"><a aria-hidden="true" tabindex="-1" href="/plugins/api#registerpluginsplugins-string"><span class="icon icon-link"></span></a>registerPlugins(plugins: string[])</h3><p>注册插件，参数为路径数组。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">registerPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;preset_2&#x27;</span><span class="token punctuation">,</span><span class="token plain"> key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;preset2&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function-variable function">apply</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./preset_3&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="haspluginspluginids-string"><a aria-hidden="true" tabindex="-1" href="/plugins/api#haspluginspluginids-string"><span class="icon icon-link"></span></a>hasPlugins(pluginIds: string[])</h3><p>判断是否有注册某个插件。</p><p>插件的 id 规则，</p><ul><li>id 默认为包名</li><li>文件级的插件，如果没有声明 id，默认为 name + 相对路径，比如 <code>@umijs/preset-react/lib/plugins/crossorigin/crossorigin</code></li><li>内置插件以 <code>@@</code> 为前缀，比如 <code>@@/registerMethod</code></li></ul><p>注：</p><ul><li>如果在注册阶段使用，只能判断<strong>在他之前</strong>是否有注册某个插件</li></ul><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 判断是否有注册 @umijs/plugin-dva</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">hasPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;@umijs/plugin-dva&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="haspresetspresetids-string"><a aria-hidden="true" tabindex="-1" href="/plugins/api#haspresetspresetids-string"><span class="icon icon-link"></span></a>hasPresets(presetIds: string[])</h3><p>判断是否有注册某个插件集。</p><p>插件集的 id 规则，</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 判断是否有注册 @umijs/preset-ui</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">hasPresets</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;@umijs/preset-ui&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li>如果在注册阶段使用，只能判断<strong>在他之前</strong>是否有注册某个插件集</li></ul><h3 id="skippluginspluginids-string"><a aria-hidden="true" tabindex="-1" href="/plugins/api#skippluginspluginids-string"><span class="icon icon-link"></span></a>skipPlugins(pluginIds: string[])</h3><p>声明哪些插件需要被禁用，参数为插件 id 的数组。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 禁用 plugin-dva 插件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">skipPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;@umijs/plugin-dva&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="扩展方法"><a aria-hidden="true" tabindex="-1" href="/plugins/api#扩展方法"><span class="icon icon-link"></span></a>扩展方法</h2><p>通过 <code>api.registerMethod()</code> 扩展的方法。</p><h3 id="addbeforemiddlewares"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addbeforemiddlewares"><span class="icon icon-link"></span></a>addBeforeMiddlewares</h3><p>添加在 webpack compiler 中间件之前的中间件，返回值格式为 express 中间件。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addBeforeMiddlewares</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">,</span><span class="token plain"> res</span><span class="token punctuation">,</span><span class="token plain"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      res</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token string">&#x27;end&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="adddepinfo"><a aria-hidden="true" tabindex="-1" href="/plugins/api#adddepinfo"><span class="icon icon-link"></span></a>addDepInfo</h3><p>添加依赖信息，包括 semver range 和别名信息。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addDepInfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    range</span><span class="token operator">:</span><span class="token plain"> pkg</span><span class="token punctuation">.</span><span class="token property-access">dependencies</span><span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    alias</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">pathToFooPackage</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addentrycode"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addentrycode"><span class="icon icon-link"></span></a>addEntryCode</h3><p>在入口文件最后添加代码。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addEntryCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">console.log(&#x27;works!&#x27;)</span><span class="token template-string template-punctuation string">`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h3 id="addentrycodeahead"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addentrycodeahead"><span class="icon icon-link"></span></a>addEntryCodeAhead</h3><p>在入口文件最前面（import 之后）添加代码。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addEntryCodeAhead</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">console.log(&#x27;works!&#x27;)</span><span class="token template-string template-punctuation string">`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h3 id="addentryimports"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addentryimports"><span class="icon icon-link"></span></a>addEntryImports</h3><p>在入口文件现有 import 的后面添加 import。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addEntryImport</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      source</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/modulePath/xxx.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      specifier</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;moduleName&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addentryimportsahead"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addentryimportsahead"><span class="icon icon-link"></span></a>addEntryImportsAhead</h3><p>在入口文件现有 import 的前面添加 import。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addEntryImportsAhead</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> source</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;anypackage&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addhtmlmetas"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addhtmlmetas"><span class="icon icon-link"></span></a>addHTMLMetas</h3><p>在 HTML 中添加 meta 标签。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addHTMLMetas</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;keywords&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;umi, umijs&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addhtmllinks"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addhtmllinks"><span class="icon icon-link"></span></a>addHTMLLinks</h3><p>在 HTML 中添加 Link 标签。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addHTMLLinks</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      rel</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;shortcut icon&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;image/x-icon&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      href</span><span class="token operator">:</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">favicon</span><span class="token operator">!</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addhtmlstyles"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addhtmlstyles"><span class="icon icon-link"></span></a>addHTMLStyles</h3><p>在 HTML 中添加 Style 标签。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addHTMLStyles</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    content</span><span class="token operator">:</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">.className { }</span><span class="token template-string template-punctuation string">`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addhtmlscripts"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addhtmlscripts"><span class="icon icon-link"></span></a>addHTMLScripts</h3><p>在 HTML 尾部添加脚本。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addHTMLScripts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      src</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...attrs</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addhtmlheadscripts"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addhtmlheadscripts"><span class="icon icon-link"></span></a>addHTMLHeadScripts</h3><p>在 HTML 头部添加脚本。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addHTMLHeadScripts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      src</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...attrs</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addmiddlewares"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addmiddlewares"><span class="icon icon-link"></span></a>addMiddlewares</h3><p>添加在 webpack compiler 中间件之后的中间件，返回值格式为 express 中间件。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addMiddlewares</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ctx</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Context</span><span class="token punctuation">,</span><span class="token plain"> next</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something before request</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something after request</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addpolyfillimports"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addpolyfillimports"><span class="icon icon-link"></span></a>addPolyfillImports</h3><p>添加补充相关的 import，在整个应用的最前面执行。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addPolyfillImports</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> source</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;./core/polyfill&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addprojectfirstlibraries"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addprojectfirstlibraries"><span class="icon icon-link"></span></a>addProjectFirstLibraries</h3><p>添加以项目依赖为优先的依赖库列表，返回值为 <code>{<!-- --> name: string; path: string <!-- -->}</code>。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addProjectFirstLibraries</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;antd&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;antd/package.json&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>比如：</p><ul><li><code>api.addProjectFirstLibraries(() =&gt; (<!-- -->{<!-- --> name: &#x27;antd&#x27;, path: dirname(require.resolve(&#x27;antd/package.json&#x27;)) <!-- -->}<!-- -->))</code>，然后用户依赖 antd 时，如果项目有依赖 antd，会用项目依赖的 antd，否则用内置的 antd</li></ul><h3 id="addruntimeplugin"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addruntimeplugin"><span class="icon icon-link"></span></a>addRuntimePlugin</h3><p>添加运行时插件，返回值格式为表示文件路径的字符串。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addRuntimePlugin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">join</span><span class="token punctuation">(</span><span class="token plain">__dirname</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;./runtime&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="addruntimepluginkey"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addruntimepluginkey"><span class="icon icon-link"></span></a>addRuntimePluginKey</h3><p>添加运行时插件的 key，返回值格式为字符串。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addRuntimePluginKey</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token string">&#x27;some&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>内置的初始值有：</p><ul><li>patchRoutes</li><li>rootContainer</li><li>render</li><li>onRouteChange</li></ul><h3 id="addumiexports"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addumiexports"><span class="icon icon-link"></span></a>addUmiExports</h3><p>添加需要 umi 额外导出的内容，返回值格式为 <code>{<!-- --> source: string, specifiers?: (string | <!-- -->{<!-- --> local: string, exported: string <!-- -->}<!-- -->)[], exportAll?: boolean <!-- -->}</code>。</p><p>比如 <code>api.addUmiExports(() =&gt; <!-- -->{<!-- --> source: &#x27;dva&#x27;, specifiers: [&#x27;connect&#x27;] <!-- -->}<!-- -->)</code>，然后就可以通过 <code>import <!-- -->{<!-- --> connect <!-- -->}<!-- --> from &#x27;umi&#x27;</code> 使用 <code>dva</code> 的 <code>connect</code> 方法了。</p><h3 id="addtmpgeneratewatcherpaths"><a aria-hidden="true" tabindex="-1" href="/plugins/api#addtmpgeneratewatcherpaths"><span class="icon icon-link"></span></a>addTmpGenerateWatcherPaths</h3><p>添加重新临时文件生成的监听路径。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">addTmpGenerateWatcherPaths</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;./app.ts&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="chainwebpackconfig--webpack-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#chainwebpackconfig--webpack-"><span class="icon icon-link"></span></a>chainWebpack(config, <!-- -->{<!-- --> webpack <!-- -->}<!-- -->)</h3><p>通过 <a target="_blank" rel="noopener noreferrer" href="https://github.com/neutrinojs/webpack-chain">webpack-chain<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的方式修改 webpack 配置。</p><p>比如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">chainWebpack</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">config</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> webpack</span><span class="token punctuation">,</span><span class="token plain"> env</span><span class="token punctuation">,</span><span class="token plain"> createCSSRule </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Set alias</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  config</span><span class="token punctuation">.</span><span class="token property-access">resolve</span><span class="token punctuation">.</span><span class="token property-access">alias</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&#x27;a&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;path/to/a&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Delete progress bar plugin</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  config</span><span class="token punctuation">.</span><span class="token property-access">plugins</span><span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">&#x27;progress&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> config</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li>需要有返回值</li></ul><h3 id="getport"><a aria-hidden="true" tabindex="-1" href="/plugins/api#getport"><span class="icon icon-link"></span></a>getPort()</h3><p>获取端口号，dev 时有效。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Port</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token method function property-access">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></pre></div><h3 id="gethostname"><a aria-hidden="true" tabindex="-1" href="/plugins/api#gethostname"><span class="icon icon-link"></span></a>getHostname()</h3><p>获取 hostname，dev 时有效。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> hostname </span><span class="token operator">=</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token method function property-access">getHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></pre></div><h3 id="modifybabelopts"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybabelopts"><span class="icon icon-link"></span></a>modifyBabelOpts</h3><p>修改 babel 配置项。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBabelOpts</span><span class="token punctuation">(</span><span class="token plain">babelOpts </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> hmr </span><span class="token operator">=</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">dva</span><span class="token operator">?.</span><span class="token plain">hmr</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">hmr</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> hmrOpts </span><span class="token operator">=</span><span class="token plain"> lodash</span><span class="token punctuation">.</span><span class="token method function property-access">isPlainObject</span><span class="token punctuation">(</span><span class="token plain">hmr</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> hmr </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      babelOpts</span><span class="token punctuation">.</span><span class="token property-access">plugins</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;babel-plugin-dva-hmr&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        hmrOpts</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> babelOpts</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifybabelpresetopts"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybabelpresetopts"><span class="icon icon-link"></span></a>modifyBabelPresetOpts</h3><p>修改 @umijs/babel-preset-umi 的配置项。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBabelPresetOpts</span><span class="token punctuation">(</span><span class="token plain">opts </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">opts</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">import</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">opts</span><span class="token punctuation">.</span><span class="token keyword">import</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain"> libraryName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;antd&#x27;</span><span class="token punctuation">,</span><span class="token plain"> libraryDirectory</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;es&#x27;</span><span class="token punctuation">,</span><span class="token plain"> style</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain"> libraryName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;antd-mobile&#x27;</span><span class="token punctuation">,</span><span class="token plain"> libraryDirectory</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;es&#x27;</span><span class="token punctuation">,</span><span class="token plain"> style</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifybundleconfig"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybundleconfig"><span class="icon icon-link"></span></a>modifyBundleConfig</h3><p>修改 bundle 配置。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBundleConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">bundleConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> env</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token punctuation">,</span><span class="token plain"> bundler</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> id </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> bundleConfig</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>参数：</p><ul><li><code>initialValue</code>：bundleConfig，可能是 webpack 的配置，通过 <code>bundler.id</code> 区分</li><li><code>args</code> _ <code>type</code>：现在有两个，ssr 和 csr _ <code>env</code>：即 api.env * <code>bundler</code>：包含 id 和 version，比如：<code>{<!-- --> id: &#x27;webpack&#x27;: version: 4 <!-- -->}</code></li></ul><h3 id="modifybundleconfigs"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybundleconfigs"><span class="icon icon-link"></span></a>modifyBundleConfigs</h3><p>修改 bundle 配置数组，比如可用于 dll、modern mode 的处理。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBundleConfigs</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">memo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> getConfig </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token plain">memo</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>参数：</p><ul><li><code>args</code> _ <code>getConfig()</code>：用于获取额外的一份配置 _ <code>env</code>：即 api.env * <code>bundler</code>：包含 id 和 version，比如：<code>{<!-- --> id: &#x27;webpack&#x27;: version: 4 <!-- -->}</code></li></ul><h3 id="modifybundleconfigopts"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybundleconfigopts"><span class="icon icon-link"></span></a>modifyBundleConfigOpts</h3><p>修改获取 bundleConfig 的函数参数。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBundleConfigOpts</span><span class="token punctuation">(</span><span class="token plain">memo </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  memo</span><span class="token punctuation">.</span><span class="token property-access">miniCSSExtractPluginPath</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;mini-css-extract-plugin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  memo</span><span class="token punctuation">.</span><span class="token property-access">miniCSSExtractPluginLoaderPath</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;mini-css-extract-plugin/dist/loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> memo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifybundleimplementor"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybundleimplementor"><span class="icon icon-link"></span></a>modifyBundleImplementor</h3><p>比如用于切换到 webpack@5 或其他。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports">webpack</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 换成 webpack@5</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBundleImplementor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> webpack</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifybundler"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifybundler"><span class="icon icon-link"></span></a>modifyBundler</h3><p>比如用于切换到 parcel 或 rollup 做构建。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyBundler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&#x27;@umijs/bundler-rollup&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Bundler</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifyconfig"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyconfig"><span class="icon icon-link"></span></a>modifyConfig</h3><p>修改最终配置。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">memo</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain">memo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain">defaultOptions</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li>修改后的值不会再做 schema 校验</li></ul><h3 id="modifydefaultconfig"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifydefaultconfig"><span class="icon icon-link"></span></a>modifyDefaultConfig</h3><p>修改默认配置。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyDefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">memo</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain">memo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain">defaultOptions</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifyhtml"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyhtml"><span class="icon icon-link"></span></a>modifyHTML</h3><p>修改 HTML，基于 <a target="_blank" rel="noopener noreferrer" href="https://github.com/cheeriojs/cheerio">cheerio<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 ast。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyHTML</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">$</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> route </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#x27;h2&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">addClass</span><span class="token punctuation">(</span><span class="token string">&#x27;welcome&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> $</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifyhtmlchunks"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyhtmlchunks"><span class="icon icon-link"></span></a>modifyHTMLChunks</h3><p>修改 html 中的js文件引入，可以用于不同的页面使用，不同的 <a href="/config#chunks">chunks</a> 配置。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyHTMLChunks</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">memo</span><span class="token punctuation">,</span><span class="token plain"> opts</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> route </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> opts</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> memo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifyexportroutemap"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyexportroutemap"><span class="icon icon-link"></span></a>modifyExportRouteMap <span class="__dumi-default-badge">3.2+</span></h3><p>修改导出路由对象 <code>routeMap</code>（路由与输出 HTML 的映射关系），触发时机在 HTML 文件生成之前，默认值为 <code>[<!-- -->{<!-- --> route: <!-- -->{<!-- --> path: &#x27;/&#x27; <!-- -->}<!-- -->, file: &#x27;index.html&#x27; <!-- -->}<!-- -->]</code>。</p><p>参数：</p><ul><li><code>html</code>：HTML 工具类实例</li></ul><p>注：</p><ul><li>只在 <code>umi build</code> 时起效</li></ul><p>例如 <code>exportStatic</code> 插件根据路由生成对应 HTML：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyExportRouteMap</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">defaultRouteMap</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> html </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> html</span><span class="token punctuation">.</span><span class="token method function property-access">getRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifydevhtmlcontent"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifydevhtmlcontent"><span class="icon icon-link"></span></a>modifyDevHTMLContent <span class="__dumi-default-badge">3.2+</span></h3><p><code>umi dev</code> 时修改输出的 HTML 内容。</p><p>参数：</p><ul><li><code>req</code>：Request 对象，可获取当前访问路径</li></ul><p>例如希望 <code>/404</code> 路由直接返回 <code>Not Found</code>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyDevHTMLContent</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">defaultHtml</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> req </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;/404&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token string">&#x27;Not Found&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> defaultHtml</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h3 id="modifyprodhtmlcontent"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyprodhtmlcontent"><span class="icon icon-link"></span></a>modifyProdHTMLContent <span class="__dumi-default-badge">3.2+</span></h3><p><code>umi build</code> 时修改输出的 HTML 内容。</p><p>参数（相当于一个 <code>RouteMap</code> 对象）：</p><ul><li><code>route</code>：路由对象</li><li><code>file</code>：输出 HTML 名称</li></ul><p>例如可以在生成 HTML 文件前，做预渲染：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyProdHTMLContent</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">content</span><span class="token punctuation">,</span><span class="token plain"> args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> route </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> args</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> render </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&#x27;your-renderer&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token operator">:</span><span class="token plain"> route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifypaths"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifypaths"><span class="icon icon-link"></span></a>modifyPaths</h3><p>修改 paths 对象。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyPaths</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">paths</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> memo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>参数：</p><ul><li><code>initialValue</code>: paths 对象</li></ul><h3 id="modifyrendererpath"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyrendererpath"><span class="icon icon-link"></span></a>modifyRendererPath</h3><p>修改 renderer 路径，用于使用自定义的 renderer。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyRendererPath</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;@umijs/renderer-mpa/package.json&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="modifypublicpathstr"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifypublicpathstr"><span class="icon icon-link"></span></a>modifyPublicPathStr</h3><p>修改 publicPath 字符串。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyPublicPathStr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">publicPath</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>参数：</p><ul><li><code>route</code>: 当前路由</li></ul><p>注：</p><ul><li>仅在配置了 runtimePublicPath 或 exportStatic?.dynamicRoot 时有效</li></ul><h3 id="modifyroutes"><a aria-hidden="true" tabindex="-1" href="/plugins/api#modifyroutes"><span class="icon icon-link"></span></a>modifyRoutes</h3><p>修改路由。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyRoutes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">routes</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">resetMainPath</span><span class="token punctuation">(</span><span class="token plain">routes</span><span class="token punctuation">,</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">mainPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onpatchroute-route-parentroute-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onpatchroute-route-parentroute-"><span class="icon icon-link"></span></a>onPatchRoute(<!-- -->{<!-- --> route, parentRoute <!-- -->}<!-- -->)</h3><p>修改路由项。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onPatchRoute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> route </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">api</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">exportStatic</span><span class="token operator">?.</span><span class="token plain">htmlSuffix</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">addHtmlSuffix</span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">!</span><span class="token operator">!</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">routes</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onpatchroutebefore-route-parentroute-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onpatchroutebefore-route-parentroute-"><span class="icon icon-link"></span></a>onPatchRouteBefore(<!-- -->{<!-- --> route, parentRoute <!-- -->}<!-- -->)</h3><p>修改路由项。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onPatchRouteBefore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> route </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">api</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">exportStatic</span><span class="token operator">?.</span><span class="token plain">htmlSuffix</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">addHtmlSuffix</span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">!</span><span class="token operator">!</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">routes</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onpatchroutes-routes-parentroute-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onpatchroutes-routes-parentroute-"><span class="icon icon-link"></span></a>onPatchRoutes(<!-- -->{<!-- --> routes, parentRoute <!-- -->}<!-- -->)</h3><p>修改路由数组。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onPatchRoutes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> routes </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// copy / to /index.html</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> rootIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  routes</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">,</span><span class="token plain"> index</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> route</span><span class="token punctuation">.</span><span class="token property-access">exact</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      rootIndex </span><span class="token operator">=</span><span class="token plain"> index</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">rootIndex </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    routes</span><span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span><span class="token plain">rootIndex</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">routes</span><span class="token punctuation">[</span><span class="token plain">rootIndex</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/index.html&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onpatchroutesbefore-routes-parentroute-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onpatchroutesbefore-routes-parentroute-"><span class="icon icon-link"></span></a>onPatchRoutesBefore(<!-- -->{<!-- --> routes, parentRoute <!-- -->}<!-- -->)</h3><p>修改路由数组。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onPatchRoutesBefore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> routes </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// copy / to /index.html</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> rootIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  routes</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">,</span><span class="token plain"> index</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">route</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> route</span><span class="token punctuation">.</span><span class="token property-access">exact</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      rootIndex </span><span class="token operator">=</span><span class="token plain"> index</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">rootIndex </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    routes</span><span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span><span class="token plain">rootIndex</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">routes</span><span class="token punctuation">[</span><span class="token plain">rootIndex</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/index.html&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onbuildcomplete-err-stats-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onbuildcomplete-err-stats-"><span class="icon icon-link"></span></a>onBuildComplete(<!-- -->{<!-- --> err?, stats? <!-- -->}<!-- -->)</h3><p>构建完成时可以做的事。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onBuildComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li>可能是失败的，注意判断 err 参数</li></ul><h3 id="ondevcompiledone-isfirstcompile-boolean-stats-webpackstats-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#ondevcompiledone-isfirstcompile-boolean-stats-webpackstats-"><span class="icon icon-link"></span></a>onDevCompileDone(<!-- -->{<!-- --> isFirstCompile: boolean, stats: webpack.Stats <!-- -->}<!-- -->)</h3><p>编译完成时可以做的事。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onDevCompileDone</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> stats</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// don&#x27;t need ssr bundler chunks</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token maybe-class-name">BundlerConfigType</span><span class="token punctuation">.</span><span class="token property-access">ssr</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// store client build chunks</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  sharedMap</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&#x27;chunks&#x27;</span><span class="token punctuation">,</span><span class="token plain"> stats</span><span class="token punctuation">.</span><span class="token property-access">compilation</span><span class="token punctuation">.</span><span class="token property-access">chunks</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注：</p><ul><li>不包含编译失败</li></ul><h3 id="ongeneratefiles"><a aria-hidden="true" tabindex="-1" href="/plugins/api#ongeneratefiles"><span class="icon icon-link"></span></a>onGenerateFiles</h3><p>生成临时文件，触发时机在 webpack 编译之前。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onGenerateFiles</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    api</span><span class="token punctuation">.</span><span class="token method function property-access">writeTmpFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;any.ts&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onpluginready"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onpluginready"><span class="icon icon-link"></span></a>onPluginReady()</h3><p>在插件初始化完成触发。在 <code>onStart</code> 之前，此时还没有 config 和 paths，他们尚未解析好。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onPluginReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onstart"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onstart"><span class="icon icon-link"></span></a>onStart()</h3><p>在命令注册函数执行前触发。可以使用 config 和 paths。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onStart</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="onexit"><a aria-hidden="true" tabindex="-1" href="/plugins/api#onexit"><span class="icon icon-link"></span></a>onExit()</h3><p>dev 退出时触发。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onExit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>参数：</p><ul><li><code>signal</code>: 值为 SIGINT、SIGQUIT 或 SIGTERM</li></ul><p>注：</p><ul><li>只针对 dev 命令有效</li></ul><h3 id="writetmpfile-path-string-content-string-skiptscheck-boolean-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#writetmpfile-path-string-content-string-skiptscheck-boolean-"><span class="icon icon-link"></span></a>writeTmpFile(<!-- -->{<!-- --> path: string, content: string, skipTSCheck?: boolean <!-- -->}<!-- -->)</h3><p>写临时文件。</p><p>e.g.</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">api</span><span class="token punctuation">.</span><span class="token method function property-access">onGenerateFiles</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    api</span><span class="token punctuation">.</span><span class="token method function property-access">writeTmpFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;any.ts&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>参数：</p><ul><li><code>path</code>：相对于临时文件夹的路径</li><li><code>content</code>：文件内容</li><li><code>skipTSCheck</code>：默认为 <code>true</code>，<code>path</code> 为 ts 或 tsx 文件，不检查 TypeScript 类型错误，如果希望插件对用户项目进行 TypeScript 类型检查，可以设置为 <code>false</code>。</li></ul><p>注：</p><ul><li>不能在注册阶段使用，通常放在 <code>api.onGenerateFiles()</code> 里，这样能在需要时重新生成临时文件</li><li>临时文件的写入做了缓存处理，如果内容一致，不会做写的操作，以减少触发 webpack 的重新编译</li></ul><h2 id="属性"><a aria-hidden="true" tabindex="-1" href="/plugins/api#属性"><span class="icon icon-link"></span></a>属性</h2><h3 id="args"><a aria-hidden="true" tabindex="-1" href="/plugins/api#args"><span class="icon icon-link"></span></a>args</h3><p>命令行参数。</p><h3 id="babelregistersetonlymap-key-string-value-string-"><a aria-hidden="true" tabindex="-1" href="/plugins/api#babelregistersetonlymap-key-string-value-string-"><span class="icon icon-link"></span></a>babelRegister.setOnlyMap(<!-- -->{<!-- --> key: string, value: string[] <!-- -->}<!-- -->)</h3><p>设置需要走 babel 编译的文件列表。</p><p>注：</p><ul><li>如果有 watch 操作，每次重复设置时请保持 key 相同</li></ul><h3 id="config"><a aria-hidden="true" tabindex="-1" href="/plugins/api#config"><span class="icon icon-link"></span></a>config</h3><p>用户配置。</p><p>注：</p><ul><li>注册阶段不能获取到，所以不能在外面 <code>const <!-- -->{<!-- --> config <!-- -->}<!-- --> = api;</code> 然后在函数体里使用，而是需要在里面通过 <code>api.paths.cwd</code> 使用</li></ul><h3 id="cwd"><a aria-hidden="true" tabindex="-1" href="/plugins/api#cwd"><span class="icon icon-link"></span></a>cwd</h3><p>当前路径。</p><h3 id="env"><a aria-hidden="true" tabindex="-1" href="/plugins/api#env"><span class="icon icon-link"></span></a>env</h3><p>即 process.env.NODE_ENV，可能有 <code>development</code>、<code>production</code> 和 <code>test</code>。</p><p>比如，</p><ul><li>命令行 <code>umi dev --foo</code>，args 为 <code>{<!-- --> _: [], foo: true <!-- -->}</code></li><li>命令行 <code>umi g page index --typescript --less</code>，args 为 <code>{<!-- --> _: [&#x27;page&#x27;, &#x27;index&#x27;], typescript: true, less: true <!-- -->}</code></li></ul><h3 id="id"><a aria-hidden="true" tabindex="-1" href="/plugins/api#id"><span class="icon icon-link"></span></a>id</h3><p>插件 id，通常是包名。</p><h3 id="logger"><a aria-hidden="true" tabindex="-1" href="/plugins/api#logger"><span class="icon icon-link"></span></a>logger</h3><p>插件日志类，包含 <code>api.logger.(log|info|debug|error|warn|profile)</code></p><p>其中 <code>api.logger.profile</code> 可用于性能耗时记录，例如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> api </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  api</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">profile</span><span class="token punctuation">(</span><span class="token string">&#x27;barId&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    api</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">profile</span><span class="token punctuation">(</span><span class="token string">&#x27;barId&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// =&gt; [PROFILE] Completed in *ms</span></div></pre></div><h3 id="key"><a aria-hidden="true" tabindex="-1" href="/plugins/api#key"><span class="icon icon-link"></span></a>key</h3><p>插件的配置 key，通常是包名的简写。</p><p>比如 <code>@umijs/plugin-dva</code>，其 key 为 <code>dva</code>；比如 <code>umi-plugin-antd</code>，其 key 为 <code>antd</code>。</p><h3 id="paths"><a aria-hidden="true" tabindex="-1" href="/plugins/api#paths"><span class="icon icon-link"></span></a>paths</h3><p>相关路径，包含：</p><ul><li><code>cwd</code>，当前路径</li><li><code>absSrcPath</code>，src 目录绝对路径，需注意 src 目录是可选的，如果没有 src 目录，<code>absSrcPath</code> 等同于 <code>cwd</code></li><li><code>absPagesPath</code>，pages 目录绝对路径</li><li><code>absTmpPath</code>，临时目录绝对路径</li><li><code>absOutputPath</code>，输出路径，默认是 <code>./dist</code></li><li><code>absNodeModulesPath</code>，node_modules 目录绝对路径</li><li><code>aliasedTmpPath</code>，以 <code>@</code> 开头的临时路径，通常用于</li></ul><p>注：</p><ul><li>注册阶段不能获取到，所以不能在外面 <code>const <!-- -->{<!-- --> paths <!-- -->}<!-- --> = api;</code> 然后在函数体里 <code>paths.cwd</code> 使用，而是需要在里面通过 <code>api.paths.cwd</code> 使用</li></ul><h3 id="pkg"><a aria-hidden="true" tabindex="-1" href="/plugins/api#pkg"><span class="icon icon-link"></span></a>pkg</h3><p>当前项目的 package.json，格式为 Object。</p><h3 id="service"><a aria-hidden="true" tabindex="-1" href="/plugins/api#service"><span class="icon icon-link"></span></a>service</h3><p>Service 实例。通常不需要用到，除非你知道为啥要用。</p><h3 id="stage"><a aria-hidden="true" tabindex="-1" href="/plugins/api#stage"><span class="icon icon-link"></span></a>stage</h3><p>Service 运行阶段。</p><h3 id="userconfig"><a aria-hidden="true" tabindex="-1" href="/plugins/api#userconfig"><span class="icon icon-link"></span></a>userConfig</h3><p>纯用户配置，就是 <code>.umirc</code> 或 <code>config/config</code> 里的内容，没有经过 defaultConfig 以及插件的任何处理。</p><p>注：</p><ul><li>和 config 的区别是，可以在注册阶段取到</li></ul><h3 id="utils"><a aria-hidden="true" tabindex="-1" href="/plugins/api#utils"><span class="icon icon-link"></span></a>utils</h3><p>utils 方法，详见 <a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi/blob/master/packages/utils/src/index.ts">@umijs/utils/src/index.ts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 包含外部库：</p><ul><li><code>lodash</code> : 导出自 <code>lodash</code>, 实用的 js 工具库。</li><li><code>got</code> : 导出自 <code>got</code>, 轻量级的请求库。</li><li><code>deepmerge</code> : 导出自 <code>deepmerge</code>, 将两个对象的可以枚举属性深度合并。</li><li><code>semver</code> : 导出自 <code>semver</code>, 用于实现版本号的解析和比较，规范版本号的格式。常见于版本过低提示用户升级等场景。</li><li><code>Mustache</code> : 导出自 <code>mustache</code>, 无逻辑的模版语法，是 JavaScript 中的 mustache 模板系统的零依赖实现。</li><li><code>address</code> : 导出自 <code>address</code>, 用于获取当前计算机的 IP ，MAC 和 DNS 服务器地址等。</li><li><code>cheerio</code> : 导出自 <code>cheerio</code>, 用于方便的处理爬取到的网页内容，在服务端对 DOM 结构进行方便的操作。</li><li><code>clipboardy</code> : 导出自 <code>clipboardy</code>, 用于对剪贴板内容写入与读取的处理。</li><li><code>chokidar</code> : 导出自 <code>chokidar</code>, 用于监听文件的变化。</li><li><code>createDebug</code>, <code>Debugger</code> : 导出自 <code>debug</code>, 用于控制调试日志的输出。</li><li><code>chalk</code> : 导出自 <code>chalk</code>, 常用于在终端中输出彩色文字，支持链式调用，能够设置文本样式、颜色、背景色等。</li><li><code>signale</code> : 导出自 <code>signale</code>, 用于日志记录、状态报告以及处理其他 Node 模块和应用的输出渲染方式。</li><li><code>portfinder</code> : 导出自 <code>portfinder</code>, 常用于在判断端口是否被占用或者获取没有被占用的端口等场景。</li><li><code>glob</code> : 导出自 <code>glob</code>, 用于获取匹配对应规则的文件。</li><li><code>pkgUp</code> : 导出自 <code>pkg-up</code>, 查找最近的 package.json 文件。</li><li><code>resolve</code> : 导出自 <code>resolve</code>,  实现了 node 的 require.resolve() 算法, 提供了方便处理获取模块完整路径相关需求的方法。</li><li><code>spawn</code> : 导出自 <code>cross-spawn</code> , 已经封装好了 Node.js 子进程（child_process）模块下 <code>spawn</code> 函数的跨平台写法的相关细节, 直接使用其调用系统上的命令如 <code>npm</code> 即可。</li><li><code>execa</code>: 导出自 <code>execa</code>, 更好的子进程管理工具。相当于衍生一个 shell，传入的 command 字符串在该 shell 中直接处理。</li><li><code>mkdirp</code> : 导出自 <code>mkdirp</code>, node 中 <code>mkdir -p</code> 功能的实现, 用于在 Node.js 中递归式创建目录及其子目录。</li><li><code>rimraf</code> : 导出自 <code>rimraf</code>, node 中 <code>rm -rf</code> 功能的实现,</li><li><code>yargs</code> : 导出自 <code>yargs</code>, 用于创建交互式命令行工具，能够方便的处理命令行参数。</li><li><code>yParser</code> : 导出自 <code>yargs-parser</code>, <code>yargs</code> 使用的强大 option 解析器, 用于解析命令行参数。</li><li><code>parser</code> : 导出自 <code>@babel/parser</code>, 解析代码生成 AST 抽象语法树。</li><li><code>traverse</code> : 导出自 <code>@babel/traverse</code>, 对 AST 节点进行递归遍历。</li><li><code>t</code> : 导出自 <code>@babel/types</code>, 用于 AST 节点的 Lodash 式工具库。它包含了构造、验证以及变换 AST 节点的方法。 该工具库包含考虑周到的工具方法，对编写处理 AST 逻辑非常有用。</li></ul><p>内部工具方法</p><ul><li><code>isBrowser</code>, 判断是否在浏览器环境。</li><li><code>isWindows</code>, 判断当前是否是 windows 系统。</li><li><code>isSSR</code>, whether SSR success in client。</li><li><code>isLernaPackage</code>, 判断是否存在 <code>lerna.json</code> 文件。</li><li><code>winPath</code>, 将文件路径转换为兼容 window 的路径，用于在代码中添加 <code>require(&#x27;/xxx/xxx.js&#x27;)</code> 之类的代码。</li><li><code>winEOL</code>, 在 windows 环境下，很多工具都会把换行符 lf 自动改成 crlf, 为了测试精准需要将换行符转化一下。</li><li><code>compatESModuleRequire</code>, 兼容 ESModule 以及 Require 为 Require。</li><li><code>mergeConfig</code>, 对象合并。</li><li><code>randomColor</code>, 随机生成颜色。</li><li><code>delay</code>, 延迟函数。</li><li><code>Generator</code>, <code>mustache</code> 模版代码生成。</li><li><code>BabelRegister</code>, <code>@babel/register</code> 的简易封装。</li><li><code>parseRequireDeps</code>, 获取特定文件的本地依赖。</li><li><code>cleanRequireCache</code>, 清理特定 Module 在 require cache 以及 parent.children  中的引用。</li><li><code>getWindowInitialProps</code>, 获取 window.g_initialProps。</li><li><code>getFile</code>, 获取特定目录中文件的完整扩展名，javascript 文件的匹配顺序 <code>[&#x27;.ts&#x27;, &#x27;.tsx&#x27;, &#x27;.js&#x27;, &#x27;.jsx&#x27;]</code>，css 文件的匹配顺序 <code>[&#x27;.less&#x27;, &#x27;.sass&#x27;, &#x27;.scss&#x27;, &#x27;.stylus&#x27;, &#x27;.css&#x27;]</code>。</li><li><code>routeToChunkName</code>, transform route component into webpack chunkName。</li></ul><p>类型</p><ul><li><code>ArgsType&lt;T extends (...args: any[]) =&gt; any&gt;</code>, 获取函数参数数组类型。</li><li><code>PartialKeys&lt;T&gt;</code>, 找出 T 中类型是 undefined 的 key。</li><li><code>PartialProps&lt;T&gt;</code>, 取出 T 中类型是 undefined 的属性。</li><li><code>NodeEnv</code>: 联合类型 &#x27;development&#x27; | &#x27;production&#x27; | &#x27;test&#x27;。</li><li><code>Omit&lt;T, U&gt;</code>, 排除 T 中的 U key。</li></ul><p>注：</p><ul><li>原则上同类功能的方法不允许使用其他的，以降低整体尺寸，比如请求用 got，参数处理用 yargs</li><li>编写插件时，除了 <code>api.utils</code>，还可通过 <code>import <!-- -->{<!-- --> utils <!-- -->}<!-- --> from &#x27;umi&#x27;</code> 取到，通常用于非插件主入口的文件</li></ul><h3 id="applypluginstype"><a aria-hidden="true" tabindex="-1" href="/plugins/api#applypluginstype"><span class="icon icon-link"></span></a>ApplyPluginsType</h3><p>为 <code>api.applyPlugins()</code> 提供 type 参数的类型，包含三种：</p><ul><li>add</li><li>modify</li><li>event</li></ul><h3 id="configchangetype"><a aria-hidden="true" tabindex="-1" href="/plugins/api#configchangetype"><span class="icon icon-link"></span></a>ConfigChangeType</h3><p>为 <code>api.describe()</code> 提供 config.onChange 的类型，目前包含两种：</p><ul><li>restart，重启 dev 进程，默认是这个</li><li>regenerateTmpFiles，重新生成临时文件</li></ul><h3 id="enableby"><a aria-hidden="true" tabindex="-1" href="/plugins/api#enableby"><span class="icon icon-link"></span></a>EnableBy</h3><p>插件的启用方式，包含三种，</p><ul><li>register</li><li>config</li><li>Function</li></ul><h3 id="html"><a aria-hidden="true" tabindex="-1" href="/plugins/api#html"><span class="icon icon-link"></span></a>Html</h3><h3 id="servicestage"><a aria-hidden="true" tabindex="-1" href="/plugins/api#servicestage"><span class="icon icon-link"></span></a>ServiceStage</h3><p><code>stage</code> 的枚举类型，通常用于和 <code>stage</code> 的比较。</p><h2 id="环境变量"><a aria-hidden="true" tabindex="-1" href="/plugins/api#环境变量"><span class="icon icon-link"></span></a>环境变量</h2><p>可以用到的环境变量。</p><ul><li>UMI_VERSION，umi 版本号</li><li>UMI_DIR，<code>umi/package.json</code> 所在的文件夹路径</li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi/edit/master/docs/plugins/api.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">5/11/2022 11:46:51</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/umi.js"></script>
  </body>
</html>
